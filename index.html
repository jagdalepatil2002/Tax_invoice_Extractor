<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataLens - Neon Noir (Final)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a102c;
            color: #d8b4fe;
        }
        .loader {
            border-top-color: #f472b6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .btn-neon {
            background-color: transparent;
            color: #f472b6;
            border: 2px solid #f472b6;
            box-shadow: 0 0 5px transparent, inset 0 0 5px transparent;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
        }
        .btn-neon:hover:not(:disabled) {
            background-color: #f472b6;
            color: #1a102c;
            box-shadow: 0 0 15px #f472b6, 0 0 25px #f472b6, inset 0 0 5px #f472b6;
        }
        .btn-neon:disabled {
            border-color: #4b5563;
            color: #4b5563;
            cursor: not-allowed;
        }

        .ready-to-process {
            animation: glow-animation 1.5s infinite ease-in-out;
        }
        @keyframes glow-animation {
            0%, 100% { box-shadow: 0 0 15px #f472b6, 0 0 25px #f472b6, inset 0 0 5px #f472b6; }
            50% { box-shadow: 0 0 5px #f472b6, inset 0 0 2px #f472b6; }
        }

        pre {
            background-color: #0c0a11;
            color: #f9fafb;
            font-family: 'Fira Code', monospace;
            padding: 1.5rem;
            border-radius: 0.5rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .json-key { color: #67e8f9; }
        .json-string { color: #f0abfc; }
        
        .success-animation { display: none; }
        .file-uploaded .success-animation { display: block; }
        .file-uploaded .upload-prompt { display: none; }
        
        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #f472b6;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }
        .checkmark {
            width: 56px; height: 56px; border-radius: 50%; display: block;
            stroke-width: 2; stroke: #fff; stroke-miterlimit: 10;
            margin: 10% auto;
            box-shadow: inset 0px 0px 0px #f472b6;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        .checkmark__check {
            transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        @keyframes scale { 0%, 100% { transform: none; } 50% { transform: scale3d(1.1, 1.1, 1); } }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 30px #f472b6; } }
    </style>
</head>
<body class="p-4">

    <div class="w-full max-w-5xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-bold text-fuchsia-300">DataLens</h1>
            <p class="text-lg text-violet-300 mt-2">Intelligently extract structured text from any image or PDF.</p>
        </header>

        <main class="bg-[#2a1a4a]/70 backdrop-blur-sm border border-violet-800 rounded-xl shadow-2xl shadow-fuchsia-500/10 p-6 md:p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Input Section -->
                <div class="flex flex-col space-y-6">
                    <div>
                        <h2 class="flex items-center text-xl font-semibold mb-3 text-fuchsia-300">
                           1. Upload a File
                        </h2>
                        <div id="dropzone" class="border-2 border-dashed border-violet-700 rounded-lg p-8 text-center cursor-pointer hover:border-fuchsia-500 hover:bg-violet-900/50 transition-all duration-300">
                            <div class="upload-prompt">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="mx-auto text-violet-500 mb-2"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M12 12v9"/><path d="m16 16-4-4-4 4"/></svg>
                                <p>Drag & drop, or <span class="font-semibold text-fuchsia-400">click to browse</span></p>
                            </div>
                            <div class="success-animation">
                                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg>
                            </div>
                            <p id="fileName" class="text-fuchsia-400 mt-2 text-sm"></p>
                        </div>
                        <input type="file" id="fileUpload" class="hidden" accept="image/png, image/jpeg, image/webp, image/bmp, application/pdf">
                    </div>

                    <div class="flex items-center text-center font-medium text-violet-500">
                        <hr class="flex-grow border-t border-violet-700"><span class="px-2">OR</span><hr class="flex-grow border-t border-violet-700">
                    </div>

                    <div>
                        <h2 class="flex items-center text-xl font-semibold mb-3 text-fuchsia-300">
                           2. Provide Image URL
                        </h2>
                        <input type="text" id="imageUrl" placeholder="https://example.com/image.png" class="w-full bg-violet-900/50 border border-violet-700 rounded-md p-3 focus:ring-2 focus:ring-fuchsia-500 focus:border-fuchsia-500 outline-none transition disabled:bg-violet-900/20 disabled:cursor-not-allowed">
                    </div>

                    <button id="processBtn" class="btn-neon w-full flex items-center justify-center font-bold py-3 px-4 rounded-lg" disabled>
                        <span id="btnText">Extract Data</span>
                        <div id="btnLoader" class="loader w-5 h-5 border-4 rounded-full hidden"></div>
                    </button>
                </div>

                <!-- Output Section -->
                <div class="flex flex-col">
                    <div class="flex justify-between items-center mb-3">
                         <h2 class="flex items-center text-xl font-semibold text-fuchsia-300">
                            Formatted Data
                        </h2>
                        <button id="copyBtn" class="bg-violet-800 hover:bg-violet-700 text-violet-300 font-semibold py-2 px-4 rounded-md text-sm transition-colors disabled:opacity-50">
                            Copy
                        </button>
                    </div>
                    <div id="status" class="text-violet-400 mb-2 min-h-[20px] transition-colors"></div>
                    <div class="bg-black/50 rounded-lg flex-grow min-h-[300px] max-h-[500px] overflow-y-auto border border-violet-800">
                        <pre id="output"><code id="json-output" class="language-json"><span class="text-violet-500">Formatted output will appear here...</span></code></pre>
                    </div>
                </div>
            </div>
        </main>
        <footer class="text-center py-8 text-sm text-violet-500">
            <p>Built by Tejas Jagdale &amp; the DataLens Team</p>
            <p id="copyright" class="mt-1"></p>
        </footer>
    </div>
    <script>
        const fileUpload=document.getElementById("fileUpload"),imageUrlInput=document.getElementById("imageUrl"),processBtn=document.getElementById("processBtn"),btnTextContainer=processBtn.querySelector("span").parentElement,btnTextSpan=document.getElementById("btnText"),btnLoader=document.getElementById("btnLoader"),statusEl=document.getElementById("status"),jsonOutputEl=document.getElementById("json-output"),copyBtn=document.getElementById("copyBtn"),dropzone=document.getElementById("dropzone"),fileNameEl=document.getElementById("fileName"),copyrightEl=document.getElementById("copyright");let currentFile=null,processedDataForCopy=[];pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js",dropzone.addEventListener("click",()=>fileUpload.click()),dropzone.addEventListener("dragover",e=>{e.preventDefault(),dropzone.classList.add("border-fuchsia-500","bg-violet-900/50")}),dropzone.addEventListener("dragleave",()=>{dropzone.classList.remove("border-fuchsia-500","bg-violet-900/50")}),dropzone.addEventListener("drop",e=>{e.preventDefault(),dropzone.classList.remove("border-fuchsia-500","bg-violet-900/50"),e.dataTransfer.files.length&&handleFile(e.dataTransfer.files[0])}),fileUpload.addEventListener("change",e=>{e.target.files.length&&handleFile(e.target.files[0])}),imageUrlInput.addEventListener("input",()=>{""!==imageUrlInput.value.trim()?(clearFileInput(),updateProcessButtonState(!0)):updateProcessButtonState(!1)}),processBtn.addEventListener("click",processInput),copyBtn.addEventListener("click",copyToClipboard),document.addEventListener("keydown",function(e){"Enter"===e.key&&!processBtn.disabled&&(e.preventDefault(),processInput())}),copyrightEl.textContent=`\xa9 ${new Date().getFullYear()} DataLens. All Rights Reserved.`;function updateProcessButtonState(e){processBtn.disabled=!e,e?processBtn.classList.add("ready-to-process"):processBtn.classList.remove("ready-to-process")}function handleFile(e){return e.type.startsWith("image/")||"application/pdf"===e.type?(clearFileInput(!1),currentFile=e,fileNameEl.textContent=e.name,fileNameEl.classList.remove("text-red-400"),fileNameEl.classList.add("text-fuchsia-400"),imageUrlInput.disabled=!0,dropzone.classList.add("file-uploaded"),void updateProcessButtonState(!0)):(fileNameEl.textContent="Invalid file type. Please select an Image or PDF.",fileNameEl.classList.add("text-red-400"),fileNameEl.classList.remove("text-fuchsia-400"),currentFile=null,void updateProcessButtonState(!1))}function clearFileInput(e=!0){e&&(currentFile=null,fileUpload.value=""),fileNameEl.textContent="",imageUrlInput.disabled=!1,dropzone.classList.remove("file-uploaded"),updateProcessButtonState(!1)}function setLoading(e){processBtn.disabled=e,e?(processBtn.classList.remove("ready-to-process"),btnTextContainer.querySelector("svg")?.classList.add("hidden"),btnTextSpan.classList.add("hidden"),btnLoader.classList.remove("hidden"),statusEl.textContent="Initializing...",jsonOutputEl.innerHTML='<span class="text-violet-500">Processing...</span>',copyBtn.disabled=!0):(btnTextContainer.querySelector("svg")?.classList.remove("hidden"),btnTextSpan.classList.remove("hidden"),btnLoader.classList.add("hidden"),updateProcessButtonState(!!currentFile||""!==imageUrlInput.value.trim()))}function formatExtractedData(e){const t={};let n=e.replace(/(\w)you(\w)/g,"$1 you $2");n=n.replace(/Failure-to-?file/gi,"Failure-to-file"),n=n.replace(/Failure-to-?pay/gi,"Failure-to-pay"),n=n.replace(/[~_]+/g,"");let a=n;const o={},i=[{key:"Notice Identifier",regex:/Notice\s+(CP\w+)/i},{key:"Tax Year",regex:/Tax year\s+(\d{4})/i},{key:"Notice Date",regex:/Notice date\s+([A-Za-z]+\s+\d{1,2},\s+\d{4})/i},{key:"Social Security Number",regex:/Social security number\s+([n\d-]+)/i},{key:"Contact Phone",regex:/To contact us\s+([\d-]+(?:\s+EXT\.\s+\w+)?)/i},{key:"Caller ID",regex:/Your caller ID\s+([a-z0-9]+)/i},{key:"Page",regex:/Page\s+(\d+\s+of\s+\d+)/i},{key:"Notice Identifier",regex:/Notice identifier\s+([A-Z0-9]+)/i}];i.forEach(e=>{if(!o[e.key]){const t=a.match(e.regex);t&&t[1]&&(o[e.key]=t[1].trim(),a=a.replace(t[0],""))}}),Object.keys(o).length>0&&(t["Notice Details"]=o);const l={},r=[{key:"Recipient Name",regex:/^([A-Z\s,.]+Q\.[A-Z\s,.]+)/m},{key:"Recipient Address",regex:/\d{2,}\s+[A-Z\s,.]+\n[A-Z\s,.]+\s+[A-Z]{2}\s+\d{5}-\d{4}/m}];r.forEach(e=>{const t=a.match(e.regex);if(t){const n=(t[1]||t[0]).trim().replace(/\n/g,", ");Object.values(l).includes(n)||(l[e.key]=n),a=a.replace(t[0],"")}}),Object.keys(l).length>0&&(t["Recipient Info"]=l);const s={},c=/Billing Summary([\s\S]*?)(?=Amount due by|What you need to do|If you agree)/m,d=a.match(c);if(d&&d[1]){const e=d[1];let t;const n=/^(Tax you owed|Payments you made|Failure-to-file penalty|Failure-to-pay penalty|Interest charges)\s+(-?\$?[\d,.]+\.\d{2})$/gm;for(;(t=n.exec(e))!==null;)s[t[1].trim()]=t[2].trim();Object.keys(s).length>0&&(t["Billing Summary"]=s,a=a.replace(d[0],""))}const u={key:"Amount Due",regex:/(?:Amount due|Amount due by.*?)\s+(\$ ?[\d,.]+\.\d{2})/gi},p=n.match(u.regex);if(p){const e=[...new Set(p.map(e=>e.match(/\$?[\d,.]+\.\d{2}/)[0]))];t["Amount Due"]=e,p.forEach(e=>{a=a.replace(e,"")})}const m={key:"Due Date",regex:/Amount due by\s+([A-Za-z]+\s+\d{1,2},\s+\d{4})/i},g=a.match(m);g&&g[1]&&(t[m.key]=g[1].trim(),a=a.replace(g[0],""));const f=[/eet eee/,/RARER SRR/,/OTANUED ON DECK/,/^\s*e\s/,/^\d{4}\s\d{7}\s\d{10}\s\d{4}$/],y=a.split("\n").map(e=>e.trim()).filter(e=>{if(e.length<5)return!1;if(/^\s*$/.test(e))return!1;if(Object.values(o).some(t=>e.includes(t)))return!1;if(Object.values(l).some(t=>e.includes(t.split(",")[0])))return!1;if(f.some(t=>t.test(e)))return!1;return!0});return y.length>0&&(t["Other Information"]=y),t}async function processInput(){const e=imageUrlInput.value.trim();if(!currentFile&&!e)return statusEl.textContent="Please upload a file or provide an image URL.",void statusEl.classList.add("text-red-400");statusEl.classList.remove("text-red-400"),setLoading(!0);try{let e=[];e=currentFile?"application/pdf"===currentFile.type?await processPdf(currentFile):[await processImage(currentFile)]:[await processImage(imageUrlInput.value.trim())];const n=e.map(e=>formatExtractedData(e));processedDataForCopy=n;const a=1===n.length?n[0]:n,o=JSON.stringify(a,null,2);jsonOutputEl.innerHTML=syntaxHighlight(o),copyBtn.disabled=!1,statusEl.textContent="Extraction Complete!",statusEl.classList.add("text-fuchsia-400")}catch(e){console.error(e),statusEl.textContent="Error during processing. Check console for details.",statusEl.classList.add("text-red-400"),jsonOutputEl.innerHTML='<span class="text-red-400">Failed to process file. The document format might not be supported by the parser.</span>'}finally{setLoading(!1)}}async function processImage(e){return(await Tesseract.recognize(e,"eng")).data.text}async function processPdf(e){const t=new FileReader;return new Promise((n,a)=>{t.onload=async()=>{try{const e=new Uint8Array(t.result),a=await pdfjsLib.getDocument(e).promise;let o=[];for(let e=1;e<=a.numPages;e++){statusEl.textContent=`Rendering page ${e} of ${a.numPages}...`;const t=await a.getPage(e),i=t.getViewport({scale:2});document.createElement("canvas");const l=document.createElement("canvas").getContext("2d");l.canvas.height=i.height,l.canvas.width=i.width,await t.render({canvasContext:l,viewport:i}).promise,statusEl.textContent=`Page ${e}/${a.numPages}: Recognizing text...`;const r=(await Tesseract.recognize(l.canvas.toDataURL("image/png"),"eng")).data.text;o.push(r)}n(o)}catch(e){a(e)}},t.onerror=a,t.readAsArrayBuffer(e)})}function syntaxHighlight(e){return e?(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){let t="json-number";return/^"/.test(e)&&(t=/:$/.test(e)?"json-key":"json-string"),'<span class="'+t+'">'+e+"</span>"}):""}function copyToClipboard(){let e="";processedDataForCopy.forEach((t,n)=>{processedDataForCopy.length>1&&(e+=`--- Page ${n+1} ---\n`);const a=["Notice Details","Recipient Info","Billing Summary","Amount Due","Due Date","Other Information"];a.forEach(n=>{if(t[n]){const a=t[n];if(Array.isArray(a))e+=`${n}: ${a.join(", ")}\n`;else if("object"==typeof a&&null!==a){e+=`${n}:\n`;for(const[t,o]of Object.entries(a))e+=`  ${t}: ${o}\n`}else e+=`${n}: ${a}\n`}}),processedDataForCopy.length>1&&(e+="\n")});const t=document.createElement("textarea");t.value=e.trim(),t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select();try{document.execCommand("copy"),statusEl.textContent="Formatted text copied to clipboard!"}catch(e){statusEl.textContent="Failed to copy."}document.body.removeChild(t)}
    </script>
</body>
</html>
